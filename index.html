<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>hyyperlink explorer</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&family=Lekton:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <header class="header">
            <a href="/" class="logo">
                <svg viewBox="0 0 20 20"><path fill="#ffffff" d="M6.70247571,4412.07175 L12.0994757,4404.08575 C12.3864757,4403.69975 13.0004757,4403.90275 13.0004757,4404.38375 L13.0004757,4415.43475 C13.0004757,4415.82075 12.5804757,4416.06175 12.2474757,4415.86675 L6.85047571,4412.80175 C6.59347571,4412.65075 6.52447571,4412.31075 6.70247571,4412.07175 L6.70247571,4412.07175 Z" transform="translate(-60, -4400)"/></svg>
                <div class="logo-text">hyyperlink</div>
            </a>
            <input type="text" class="search-bar" placeholder="Search by transaction or address...">
        </header>

        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-label">Total Transactions</div>
                <div class="stat-value" id="tx-count">-</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Total Addresses</div>
                <div class="stat-value" id="address-count">-</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Total Supply</div>
                <div class="stat-value" id="total-supply">-</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Burned Tokens</div>
                <div class="stat-value" id="burned-tokens">-</div>
            </div>
        </div>

        <div class="transaction-feed">
            <div class="feed-header">Live Transactions</div>
            <div id="transactions"></div>
        </div>

        <div class="attribution" id="attribution"></div>
    </div>

    <script>
        const API_ENDPOINTS = [
            "api.colibri.testnet.hyyperlink.com",
            "api.ox.testnet.hyyperlink.com",
            "api.rex.testnet.hyyperlink.com"
        ];

        const selectedNode = API_ENDPOINTS[Math.floor(Math.random() * API_ENDPOINTS.length)];
        const API_BASE = `https://${selectedNode}/api/v1`;

        function formatNumber(num, decimals = 8) {
            return new Intl.NumberFormat('en-US', {
                minimumFractionDigits: decimals,
                maximumFractionDigits: decimals
            }).format(num);
        }

        function formatDate(timestamp) {
            return new Date(timestamp / 1000000).toLocaleString();
        }

        function getTransactionIcon(type) {
            const icons = {
                mining: 'ðŸ‘·',
                transfer: 'ðŸ’¸',
                swap: 'ðŸ”„',
                token: 'ðŸª™',
                pool: 'ðŸŒŠ'
            };
            return icons[type] || 'ðŸ“¦';
        }

        async function loadStats() {
            const response = await fetch(`${API_BASE}/stats`);
            const data = await response.json();
            if (data.success) {
                document.getElementById('tx-count').textContent = data.data.transaction_count.toLocaleString();
                document.getElementById('address-count').textContent = data.data.address_count.toLocaleString();
                document.getElementById('total-supply').textContent = (100 + data.data.total_supply).toFixed(1) + 'M';
                document.getElementById('burned-tokens').textContent = formatNumber(data.data.burned_tokens);
            }
        }

        async function loadTransactions() {
            const response = await fetch(`${API_BASE}/transactions/recent?limit=10`);
            const data = await response.json();
            if (data.success) {
                document.getElementById('transactions').innerHTML = data.data.map(tx => {
                    const type = tx.changes?.[0]?.instruction_type.replace('Instruction', '').toLowerCase() || 'unknown';
                    const amount = type === 'miningreward' ? 
                        tx.changes[0].amount / 100000000 : 
                        tx.changes?.[0]?.amount || 0;

                    return `
                        <div class="transaction">
                            <div class="tx-icon">${getTransactionIcon(type)}</div>
                            <div class="tx-details">
                                <a href="/transaction.html?hash=${tx.hash}" class="tx-hash">${tx.hash}</a>
                                <div class="tx-meta">${formatDate(tx.timestamp)} Â· ${formatNumber(tx.fee)} HYY fee</div>
                            </div>
                            <div class="tx-amount">${formatNumber(amount)} HYY</div>
                        </div>
                    `;
                }).join('');
            }
        }

        document.querySelector('.search-bar').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                const query = e.target.value.trim();
                if (query) {
                    window.location.href = query.length === 64 ? 
                        `/transaction.html?hash=${query}` : 
                        `/account.html?address=${query}`;
                }
            }
        });

        async function initialize() {
            await Promise.all([loadStats(), loadTransactions()]);
            document.getElementById('attribution').innerHTML = 
                `this data was served by <span>${selectedNode.split('.')[1]}</span>`;
        }

        initialize();
        setInterval(loadTransactions, 5000);
    </script>
</body>
</html>